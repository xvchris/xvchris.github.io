<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Clash TUN 模式与 Tailscale 共存：完整排查与解决方案 - Chris Blog</title><meta name=author content="Chris">
<meta name=description content="解决 mihomo TUN 模式下无法访问 Tailscale MagicDNS 的问题，深入分析 auto-detect-interface 与虚拟网卡冲突的根因"><meta name=keywords content='Clash,Tailscale,网络,macOS,mihomo'><meta itemprop=name content="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><meta itemprop=description content="解决 mihomo TUN 模式下无法访问 Tailscale MagicDNS 的问题，深入分析 auto-detect-interface 与虚拟网卡冲突的根因"><meta itemprop=datePublished content="2026-02-11T18:00:00+08:00"><meta itemprop=dateModified content="2026-02-14T21:23:41+08:00"><meta itemprop=wordCount content="2283"><meta itemprop=keywords content="Clash,Tailscale,网络,MacOS,Mihomo"><meta property="og:url" content="https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/"><meta property="og:site_name" content="Chris Blog"><meta property="og:title" content="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><meta property="og:description" content="解决 mihomo TUN 模式下无法访问 Tailscale MagicDNS 的问题，深入分析 auto-detect-interface 与虚拟网卡冲突的根因"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-11T18:00:00+08:00"><meta property="article:modified_time" content="2026-02-14T21:23:41+08:00"><meta property="article:tag" content="Clash"><meta property="article:tag" content="Tailscale"><meta property="article:tag" content="网络"><meta property="article:tag" content="MacOS"><meta property="article:tag" content="Mihomo"><meta name=twitter:card content="summary"><meta name=twitter:title content="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><meta name=twitter:description content="解决 mihomo TUN 模式下无法访问 Tailscale MagicDNS 的问题，深入分析 auto-detect-interface 与虚拟网卡冲突的根因"><meta name=application-name content="Chris Blog"><meta name=apple-mobile-web-app-title content="Chris Blog"><meta name=theme-color data-light=#f8f8f8 data-dark=#0c0e12 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=favicons/ghost.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical type=text/html href=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/ title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案 - Chris Blog"><link rel=prev type=text/html href=https://www.gameol.site/about/ title=关于><link rel=alternate type=text/markdown href=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/index.md title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案 - Chris Blog"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Clash TUN 模式与 Tailscale 共存：完整排查与解决方案","inLanguage":"zh-cn","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.gameol.site\/posts\/20260211-clash-tun-tailscale-coexist\/"},"image":["https:\/\/www.gameol.site\/images\/og-image.png"],"genre":"posts","keywords":"Clash, Tailscale, 网络, macOS, mihomo","wordcount":2283,"url":"https:\/\/www.gameol.site\/posts\/20260211-clash-tun-tailscale-coexist\/","datePublished":"2026-02-11T18:00:00+08:00","dateModified":"2026-02-14T21:23:41+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Chris"},"description":"解决 mihomo TUN 模式下无法访问 Tailscale MagicDNS 的问题，深入分析 auto-detect-interface 与虚拟网卡冲突的根因"}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Chris Blog"><span class=header-title-pre><i class='fa-solid fa-terminal fa-fw' style=color:#0aff9d></i></span><span class=header-title-text>Chris Blog</span></a><span class="typeit header-subtitle"><template></template></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-pen-nib fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/downloads/><i class="fa-solid fa-download fa-fw fa-sm" aria-hidden=true></i> 资源</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容…… id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Chris Blog"><span class=header-title-pre><i class='fa-solid fa-terminal fa-fw' style=color:#0aff9d></i></span><span class=header-title-text>Chris Blog</span></a><span class="typeit header-subtitle"><template></template></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容…… id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-pen-nib fa-fw fa-sm" aria-hidden=true></i> 文章</a></li><li class=menu-item><a class=menu-link href=/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 归档</a></li><li class=menu-item><a class=menu-link href=/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/downloads/><i class="fa-solid fa-download fa-fw fa-sm" aria-hidden=true></i> 资源</a></li><li class=menu-item><a class=menu-link href=/friends/><i class="fa-solid fa-user-group fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-circle-info fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class=breadcrumb-container><ol class=breadcrumb><li class=breadcrumb-item data-separator=/><a href=/ title="Chris Blog">主页</a></li><li class=breadcrumb-item data-separator=/><a href=/posts/ title=Posts>文章</a></li><li class="breadcrumb-item active" data-separator=/ aria-current=page>Clash TUN 模式与 Tailscale 共存：完整排查与解决方案</li></ol></nav><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=合集><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>相关内容</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/posts/20250822-zellij-ubuntu-deployment/ title=Zellij终端复用器Ubuntu部署指南>Zellij终端复用器Ubuntu部署指南</a></li><li class=related-item><a href=/posts/20250814-rust-env-init/ title=Rust开发环境初始化>Rust开发环境初始化</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Clash TUN 模式与 Tailscale 共存：完整排查与解决方案</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.gameol.site title=作者 target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=/images/avatar.jpg alt=Chris height=16 width=16>&nbsp;Chris</a></span><span class=post-included-in>&nbsp;收录于 <a href=/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/ class=post-category title="分类 - 开发工具"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> 开发工具</a></span></div><div class=post-meta-line><span title="发布于 2026-02-11 18:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2026-02-11>2026-02-11</time></span>&nbsp;<span title="更新于 2026-02-14 21:23:41"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2026-02-14>2026-02-14</time></span>&nbsp;<span title="2283 字"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>约 2300 字</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>预计阅读 5 分钟</span>&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#问题描述>问题描述</a></li><li><a href=#根因分析>根因分析</a><ul><li><a href=#mihomo-tun-模式的工作原理>mihomo TUN 模式的工作原理</a></li><li><a href=#问题出在哪>问题出在哪</a></li><li><a href=#为什么系统命令正常但-clash-不行>为什么系统命令正常但 Clash 不行</a></li></ul></li><li><a href=#解决方案>解决方案</a><ul><li><a href=#第一步确认-tailscale-使用的网卡接口>第一步：确认 Tailscale 使用的网卡接口</a></li><li><a href=#第二步配置-mihomo>第二步：配置 mihomo</a><ul><li><a href=#1-dns强制通过-tailscale-接口查询>1. DNS：强制通过 Tailscale 接口查询</a></li><li><a href=#2-代理创建绑定接口的-direct-代理>2. 代理：创建绑定接口的 direct 代理</a></li><li><a href=#3-规则tailscale-流量使用绑定接口的代理>3. 规则：Tailscale 流量使用绑定接口的代理</a></li><li><a href=#4-tun排除-tailscale-接口>4. TUN：排除 Tailscale 接口</a></li></ul></li><li><a href=#完整配置示例>完整配置示例</a></li><li><a href=#另一个坑route-exclude-address-不生效>另一个坑：<code>route-exclude-address</code> 不生效</a></li></ul></li><li><a href=#补充配合-peer-relay-使用>补充：配合 Peer Relay 使用</a></li><li><a href=#排查命令速查>排查命令速查</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class=content id=content data-end-flag="— EOF —"><h2 class=heading-element id=问题描述><span>问题描述</span>
<a href=#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>开启 Clash（mihomo 内核）的 TUN 模式后，无法访问 Tailscale 的 MagicDNS 域名（<code>*.ts.net</code>），Clash 日志报错：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[TCP] dial DIRECT (match DomainSuffix/ts.net) 127.0.0.1:60140 --&gt; studio.tail7f8eb.ts.net:443 error: dns resolve failed: context deadline exceeded</span></span></code></pre></td></tr></table></div></div><p>环境信息：</p><ul><li>macOS（Darwin）</li><li>Clash Party（mihomo-party），内核为 mihomo</li><li>Tailscale，使用 MagicDNS</li></ul><h2 class=heading-element id=根因分析><span>根因分析</span>
<a href=#%e6%a0%b9%e5%9b%a0%e5%88%86%e6%9e%90 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>这个问题的本质不是规则配置错误，而是 <strong>mihomo 的 <code>auto-detect-interface</code> 机制与 Tailscale 的虚拟网卡冲突</strong>。</p><h3 class=heading-element id=mihomo-tun-模式的工作原理><span>mihomo TUN 模式的工作原理</span>
<a href=#mihomo-tun-%e6%a8%a1%e5%bc%8f%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>mihomo 开启 TUN 后，会创建一个虚拟网卡（如 <code>utun1500</code>）接管系统所有流量。为了防止自身出站流量再次被 TUN 拦截（回环），mihomo 会"保护"自己的出站连接——通过 <code>auto-detect-interface</code> 自动检测出站接口，将自身流量直接发往物理网卡（如 <code>en0</code>）。</p><h3 class=heading-element id=问题出在哪><span>问题出在哪</span>
<a href=#%e9%97%ae%e9%a2%98%e5%87%ba%e5%9c%a8%e5%93%aa class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Tailscale 的设备通过虚拟网卡 <code>utun4</code>（编号可能不同）通信，IP 段为 <code>100.64.0.0/10</code>，MagicDNS 服务器地址为 <code>100.100.100.100</code>。这些地址<strong>只能通过 Tailscale 的虚拟网卡访问</strong>，物理网卡根本不可达。</p><p>但 mihomo 的 <code>auto-detect-interface</code> 不认识 Tailscale 的路由，<strong>把所有出站流量（包括发往 <code>100.100.100.100</code> 的 DNS 查询）都检测到了 <code>en0</code></strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[DNS] resolve studio.tail7f8eb.ts.net A from udp://100.100.100.100:53
</span></span><span class=line><span class=cl>[TUN] Auto detect interface for 100.100.100.100 --&gt; en0  ← 错误！应该走 utun4</span></span></code></pre></td></tr></table></div></div><p>这导致了两个层面的故障：</p><ol><li><strong>DNS 解析失败</strong>：mihomo 通过 <code>en0</code> 向 <code>100.100.100.100</code> 发 DNS 查询 → 不可达 → 超时</li><li><strong>TCP 连接失败</strong>：即使 DNS 解析成功，mihomo 通过 <code>en0</code> 向 Tailscale IP 发起 TCP 连接 → 同样不可达 → 超时</li></ol><h3 class=heading-element id=为什么系统命令正常但-clash-不行><span>为什么系统命令正常但 Clash 不行</span>
<a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e7%b3%bb%e7%bb%9f%e5%91%bd%e4%bb%a4%e6%ad%a3%e5%b8%b8%e4%bd%86-clash-%e4%b8%8d%e8%a1%8c class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 正常！普通进程走系统路由表，100.100.100.100 路由到 utun4</span>
</span></span><span class=line><span class=cl>$ ping 100.100.100.100
</span></span><span class=line><span class=cl><span class=m>64</span> bytes from 100.100.100.100: <span class=nv>icmp_seq</span><span class=o>=</span><span class=m>0</span> <span class=nv>ttl</span><span class=o>=</span><span class=m>64</span> <span class=nv>time</span><span class=o>=</span>0.943 ms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 正常！</span>
</span></span><span class=line><span class=cl>$ nslookup studio.tail7f8eb.ts.net 100.100.100.100
</span></span><span class=line><span class=cl>Name:    studio.tail7f8eb.ts.net
</span></span><span class=line><span class=cl>Address: 100.95.73.65</span></span></code></pre></td></tr></table></div></div><p>普通进程遵循系统路由表（<code>100.100.100.100/32 → utun4</code>），而 mihomo 为防 TUN 回环，绕过了路由表直接走 <code>en0</code>。</p><h2 class=heading-element id=解决方案><span>解决方案</span>
<a href=#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>核心思路：<strong>不依赖 mihomo 的自动接口检测，显式指定 Tailscale 流量走 <code>utun4</code> 接口</strong>。</p><h3 class=heading-element id=第一步确认-tailscale-使用的网卡接口><span>第一步：确认 Tailscale 使用的网卡接口</span>
<a href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e7%a1%ae%e8%ae%a4-tailscale-%e4%bd%bf%e7%94%a8%e7%9a%84%e7%bd%91%e5%8d%a1%e6%8e%a5%e5%8f%a3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ifconfig <span class=p>|</span> grep -E <span class=s2>&#34;^utun|inet 100\.&#34;</span>
</span></span><span class=line><span class=cl>utun4: <span class=nv>flags</span><span class=o>=</span>8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu <span class=m>1280</span>
</span></span><span class=line><span class=cl>	inet 100.70.0.1 --&gt; 100.70.0.1 netmask 0xffffffff</span></span></code></pre></td></tr></table></div></div><p>记住这个接口名（本例为 <code>utun4</code>），后续配置需要用到。</p><blockquote><p><strong>注意</strong>：macOS 上 Tailscale 的 utun 编号不固定，重启后可能变化。如果发现连接又断了，先检查接口编号是否变了。可以用以下命令自动获取：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>tailscale_iface</span><span class=o>=</span><span class=k>$(</span>ifconfig <span class=p>|</span> grep -B1 <span class=s2>&#34;inet 100\.&#34;</span> <span class=p>|</span> head -1 <span class=p>|</span> cut -d: -f1<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;当前 Tailscale 接口: </span><span class=nv>$tailscale_iface</span><span class=s2>&#34;</span></span></span></code></pre></td></tr></table></div></div></blockquote><h3 class=heading-element id=第二步配置-mihomo><span>第二步：配置 mihomo</span>
<a href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e9%85%8d%e7%bd%ae-mihomo class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>需要修改三个方面的配置：</p><h4 class=heading-element id=1-dns强制通过-tailscale-接口查询><span>1. DNS：强制通过 Tailscale 接口查询</span>
<a href=#1-dns%e5%bc%ba%e5%88%b6%e9%80%9a%e8%bf%87-tailscale-%e6%8e%a5%e5%8f%a3%e6%9f%a5%e8%af%a2 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><p>使用 <code>#interface</code> 语法绑定 DNS 出站接口：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;+.ts.net&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;100.100.100.100#utun4&#34;</span></span></span></code></pre></td></tr></table></div></div><p><code>100.100.100.100#utun4</code> 告诉 mihomo：向 <code>100.100.100.100</code> 发 DNS 查询时，强制走 <code>utun4</code> 接口，不要自动检测。</p><blockquote><p>不需要给 <code>tailscale.com</code> 配置 MagicDNS——它是普通互联网域名，用系统默认 DNS 解析即可。</p></blockquote><blockquote><p><strong>踩坑提醒</strong>：不要用 <code>%utun4</code>，<code>%</code> 会被解析为 URL 编码导致报错。正确语法是 <code>#</code>。</p></blockquote><h4 class=heading-element id=2-代理创建绑定接口的-direct-代理><span>2. 代理：创建绑定接口的 direct 代理</span>
<a href=#2-%e4%bb%a3%e7%90%86%e5%88%9b%e5%bb%ba%e7%bb%91%e5%ae%9a%e6%8e%a5%e5%8f%a3%e7%9a%84-direct-%e4%bb%a3%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>proxies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>direct</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interface-name</span><span class=p>:</span><span class=w> </span><span class=l>utun4</span></span></span></code></pre></td></tr></table></div></div><p>这定义了一个名为 <code>Tailscale</code> 的代理，本质是直连，但强制所有流量通过 <code>utun4</code> 接口发出。</p><h4 class=heading-element id=3-规则tailscale-流量使用绑定接口的代理><span>3. 规则：Tailscale 流量使用绑定接口的代理</span>
<a href=#3-%e8%a7%84%e5%88%99tailscale-%e6%b5%81%e9%87%8f%e4%bd%bf%e7%94%a8%e7%bb%91%e5%ae%9a%e6%8e%a5%e5%8f%a3%e7%9a%84%e4%bb%a3%e7%90%86 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Tailscale 域名和 IP 走绑定 utun4 的 direct 代理</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-SUFFIX,tail7f8eb.ts.net,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IP-CIDR,100.64.0.0/10,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IP-CIDR,fd7a:115c:a1e0::/48,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Tailscale 进程本身保持 DIRECT（它自己管理路由）</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>PROCESS-NAME,tailscale,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>PROCESS-NAME,tailscaled,DIRECT</span></span></span></code></pre></td></tr></table></div></div><blockquote><p><strong>为什么不用 <code>DOMAIN-SUFFIX,ts.net</code>？</strong> <code>ts.net</code> 会匹配所有 Tailscale 用户的域名。更精确的做法是只匹配你自己的 tailnet 域名（如 <code>tail7f8eb.ts.net</code>），在 Tailscale 管理后台的 DNS 页面可以查到。</p></blockquote><blockquote><p><strong>为什么不加 <code>DOMAIN-SUFFIX,tailscale.com</code>？</strong> <code>tailscale.com</code> 是普通互联网网站（文档、博客、管理后台），强制走 <code>utun4</code> 但没有配置出口节点会导致网站打不开。<code>tailscaled</code> 进程的控制面流量已经被 <code>PROCESS-NAME,tailscaled,DIRECT</code> 处理了，不需要域名规则兜底。</p></blockquote><p><strong>关键</strong>：域名和 IP 规则使用 <code>Tailscale</code>（绑定 utun4 的 direct 代理），而非 <code>DIRECT</code>。<code>DIRECT</code> 会触发 <code>auto-detect-interface</code>，又会错误地走 <code>en0</code>。</p><h4 class=heading-element id=4-tun排除-tailscale-接口><span>4. TUN：排除 Tailscale 接口</span>
<a href=#4-tun%e6%8e%92%e9%99%a4-tailscale-%e6%8e%a5%e5%8f%a3 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>tun</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exclude-interface</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>utun4</span></span></span></code></pre></td></tr></table></div></div><p>防止 Tailscale 自身的流量被 TUN 拦截。</p><h3 class=heading-element id=完整配置示例><span>完整配置示例</span>
<a href=#%e5%ae%8c%e6%95%b4%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>以下是 Clash Party 覆写文件的完整示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>+proxies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>direct</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>interface-name</span><span class=p>:</span><span class=w> </span><span class=l>utun4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>+rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-SUFFIX,tail7f8eb.ts.net,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IP-CIDR,100.64.0.0/10,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IP-CIDR,fd7a:115c:a1e0::/48,Tailscale</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>PROCESS-NAME,tailscale,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>PROCESS-NAME,tailscaled,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&lt;+.ts.net&gt;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;100.100.100.100#utun4&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>tun</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>exclude-interface</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>utun4</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>注：<code>+rules:</code>、<code>+proxies:</code> 和 <code>&lt;key>:</code> 是 Clash Party 的覆写语法。如果你使用其他客户端或直接编辑 mihomo 配置文件，请将这些内容合并到对应字段中。</p></blockquote><h3 class=heading-element id=另一个坑route-exclude-address-不生效><span>另一个坑：<code>route-exclude-address</code> 不生效</span>
<a href=#%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%9d%91route-exclude-address-%e4%b8%8d%e7%94%9f%e6%95%88 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>你可能会想在 TUN 配置中添加 <code>route-exclude-address</code> 来排除 Tailscale 网段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>tun</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>route-exclude-address</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>100.64.0.0</span><span class=l>/10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>fd7a:115c:a1e0::/48</span></span></span></code></pre></td></tr></table></div></div><p><strong>但在 Clash Party 中这个配置大概率不生效。</strong> Clash Party 的内核设置（<code>mihomo.yaml</code>）中 <code>route-exclude-address: []</code> 会在合并时覆盖覆写文件的值。即使直接编辑 <code>mihomo.yaml</code>，Clash Party 重启时也可能从内部状态恢复为空数组。</p><p>而且即使 <code>route-exclude-address</code> 生效，它只影响系统路由表，<strong>不影响 mihomo 自身的 <code>auto-detect-interface</code> 行为</strong>，所以并不能解决根本问题。真正的解决方案是上面的 <code>interface-name</code> + <code>#interface</code> 方案。推荐搭配 <code>tun.exclude-interface</code> 和 IP 规则来实现等效效果。</p><h2 class=heading-element id=补充配合-peer-relay-使用><span>补充：配合 Peer Relay 使用</span>
<a href=#%e8%a1%a5%e5%85%85%e9%85%8d%e5%90%88-peer-relay-%e4%bd%bf%e7%94%a8 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>如果你有自建服务器（比如 VPS），可以配置 <a href=https://tailscale.com/kb/1478/peer-relay target=_blank rel="external nofollow noopener noreferrer">Tailscale Peer Relay<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>。Peer Relay 和本文的 TUN 共存方案是互补的：</p><ul><li><strong>TUN 共存方案</strong>解决的是本地 Clash 和 Tailscale 流量路由冲突</li><li><strong>Peer Relay</strong> 解决的是节点之间的连接质量问题——当两个节点无法直连（NAT 打洞失败）时，流量会走 Tailscale 官方的 DERP 中继服务器，延迟较高。配置 Peer Relay 后，流量会优先走你自己的中继服务器，比 DERP 快得多</li></ul><p>两者可以同时启用，互不冲突。</p><h2 class=heading-element id=排查命令速查><span>排查命令速查</span>
<a href=#%e6%8e%92%e6%9f%a5%e5%91%bd%e4%bb%a4%e9%80%9f%e6%9f%a5 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看 Tailscale 使用的接口</span>
</span></span><span class=line><span class=cl>ifconfig <span class=p>|</span> grep -E <span class=s2>&#34;^utun|inet 100\.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试 Tailscale DNS 是否可达（系统级）</span>
</span></span><span class=line><span class=cl>nslookup studio.tail7f8eb.ts.net 100.100.100.100
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试 mihomo 内部 DNS 解析（通过 API）</span>
</span></span><span class=line><span class=cl>curl --noproxy <span class=s1>&#39;*&#39;</span> --unix-socket /tmp/mihomo-party-*.sock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=s2>&#34;http://localhost/dns/query?name=studio.tail7f8eb.ts.net&amp;type=A&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看 mihomo 实时日志（含接口检测信息）</span>
</span></span><span class=line><span class=cl>curl --noproxy <span class=s1>&#39;*&#39;</span> --unix-socket /tmp/mihomo-party-*.sock <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=s2>&#34;http://localhost/logs?level=debug&#34;</span> -N
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看系统路由表</span>
</span></span><span class=line><span class=cl>netstat -rn <span class=p>|</span> grep -E <span class=s2>&#34;utun|100\.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看系统 DNS 配置</span>
</span></span><span class=line><span class=cl>scutil --dns <span class=p>|</span> head -30</span></span></code></pre></td></tr></table></div></div><h2 class=heading-element id=总结><span>总结</span>
<a href=#%e6%80%bb%e7%bb%93 class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><table><thead><tr><th>层面</th><th>问题</th><th>解决</th></tr></thead><tbody><tr><td>DNS 解析</td><td>mihomo 向 <code>100.100.100.100</code> 查询时走了 <code>en0</code></td><td><code>nameserver-policy</code> 使用 <code>#utun4</code> 绑定接口</td></tr><tr><td>TCP 连接</td><td>mihomo 向 Tailscale IP 连接时走了 <code>en0</code></td><td><code>type: direct</code> + <code>interface-name: utun4</code> 代理</td></tr><tr><td>TUN 拦截</td><td>Tailscale 自身流量被 TUN 捕获</td><td><code>exclude-interface: utun4</code></td></tr></tbody></table><p>一句话总结：<strong>mihomo TUN 的防回环机制会绕过系统路由表，导致 Tailscale 的虚拟网卡流量被错误地发往物理网卡。解决方案是在 DNS 和代理两个层面都显式指定 <code>utun4</code> 接口。</strong></p></div><hr class=awesome-hr><h2 id=see-also>相关内容</h2><ul><li><a href=/posts/20250822-zellij-ubuntu-deployment/ title=Zellij终端复用器Ubuntu部署指南>Zellij终端复用器Ubuntu部署指南</a></li><li><a href=/posts/20250814-rust-env-init/ title=Rust开发环境初始化>Rust开发环境初始化</a></li></ul><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="更新于 2026-02-14 21:23:41">更新于 2026-02-14&nbsp;<a class=git-hash href=https://github.com/xvchris/blog/commit/de30a79518730a153e2771210b8747f374fce38c rel="external nofollow noopener noreferrer" target=_blank title="优化 Clash TUN + Tailscale 文章：删除 tailscale.com 规则、精确 tailnet 域名、补充自动检测脚本和 Peer Relay&#10&#10Commit: de30a79518730a153e2771210b8747f374fce38c [de30a79]&#10Author: chris&#10Date: 2026-02-14 21:23:41"><i class="fa-solid fa-hashtag fa-fw" aria-hidden=true></i>de30a79</a></span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/posts/20260211-clash-tun-tailscale-coexist/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href="https://github.com/xvchris/blog/blob/main/content/posts/dev/20260211-clash-tun-tailscale-coexist.md?plain=1" title=查看源码 target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>查看源码</a></span><span><a href=https://github.com/xvchris/blog/edit/main/content/posts/dev/20260211-clash-tun-tailscale-coexist.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span><span><a href="https://github.com/xvchris/blog/issues/new?title=[BUG]%20Clash+TUN+%E6%A8%A1%E5%BC%8F%E4%B8%8E+Tailscale+%E5%85%B1%E5%AD%98%EF%BC%9A%E5%AE%8C%E6%95%B4%E6%8E%92%E6%9F%A5%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cClash+TUN+%E6%A8%A1%E5%BC%8F%E4%B8%8E+Tailscale+%E5%85%B1%E5%AD%98%EF%BC%9A%E5%AE%8C%E6%95%B4%E6%8E%92%E6%9F%A5%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%7c%0A%7cURL%7chttps://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/%7c%0A%7cFilename%7chttps://github.com/xvchris/blog/blob/main/content/posts/dev/20260211-clash-tun-tailscale-coexist.md?plain=1%7c" title=报告问题 target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>报告问题</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 X" data-sharer=twitter data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/ data-title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案" data-hashtags=Clash,Tailscale,网络,macOS,mihomo><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/ data-title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><i class="fa-brands fa-hacker-news fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Reddit" data-sharer=reddit data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Pocket" data-sharer=pocket data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/><i class="fa-brands fa-get-pocket fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.gameol.site/posts/20260211-clash-tun-tailscale-coexist/ data-title="Clash TUN 模式与 Tailscale 共存：完整排查与解决方案"><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/clash/ class=post-tag title="标签 - Clash">Clash</a><a href=/tags/tailscale/ class=post-tag title="标签 - Tailscale">Tailscale</a><a href=/tags/%E7%BD%91%E7%BB%9C/ class=post-tag title="标签 - 网络">网络</a><a href=/tags/macos/ class=post-tag title="标签 - MacOS">MacOS</a><a href=/tags/mihomo/ class=post-tag title="标签 - Mihomo">Mihomo</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/20250919-3proxy-deb-installation-guide/ class=post-nav-item rel=prev title="3proxy .Deb包安装教程：Socks5 + HTTP + 用户名密码认证"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>3proxy .Deb包安装教程：Socks5 + HTTP + 用户名密码认证</a></div></div><div id=comments><div id=giscus class=comment><script src=https://giscus.app/client.js data-repo=xvchris/blog data-repo-id=R_kgDOPdqi-A data-category=Announcements data-category-id=DIC_kwDOPdqi-M4C2NLC data-mapping=pathname data-strict=1 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-lang=zh-CN data-loading=lazy crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article><aside class=toc id=toc-auto aria-label=目录><h2 class=toc-title>目录&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.0"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.20"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2025 - 2026</span><span class=author itemprop=copyrightHolder>
<a href=https://www.gameol.site target=_blank rel="external nofollow noopener noreferrer">Chris</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title=网站运行中……><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="ms-1 d-none">运行 </span><span class="run-times ms-1">网站运行中……</span></span></div><div class="footer-line visitor"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw me-1" aria-hidden=true></i><span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label=查看评论><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#00c853;--bg-progress-dark:#0aff9d></div><noscript><div class=noscript-warning>该网站在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=preload href=/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/purple/pace-theme-minimal.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/fuse/fuse.min.js defer></script><script src=/lib/instant-page/instantpage.min.js async defer type=module></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/typeit/index.umd.js defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=https://vercount.one/js async defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark_dimmed",lightTheme:"light",origin:"https://giscus.app"}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/search.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:30,threshold:.3,type:"fuse",useExtendedSearch:!1},siteTime:"2025-08-22T09:15:28+08:00",typeit:{cursorChar:"▍",cursorSpeed:800,duration:-1,loop:!1,speed:100},version:"v0.3.20"}</script><script src=/js/theme.min.js defer></script><script src=/js/custom.min.js defer></script></body></html>